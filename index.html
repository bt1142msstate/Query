<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Library Item Reports</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
</head>
<body class="relative min-h-screen overflow-hidden pt-16 px-6 pb-6" id="page-body">
  <div id="overlay"></div>
  
  <!-- New Header Bar -->
  <div id="header-bar" class="fixed top-0 left-0 right-0 bg-indigo-800 text-white shadow-lg py-3 px-6 flex justify-between items-center z-50">
    <div class="w-32"><!-- Left spacer to balance the header --></div>
    <h1 class="text-xl font-bold text-center">Item Reporter</h1>
    <div id="header-controls" class="flex gap-2">
      <button id="run-query-btn"
        class="p-2 rounded-full bg-green-500 hover:bg-green-600 text-white focus:outline-none transition-colors"
        aria-label="Run query">
        <!-- Play icon -->
        <svg id="run-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
          <polygon points="5,3 19,12 5,21"></polygon>
        </svg>
        <!-- Stop icon (hidden by default) -->
        <svg id="stop-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
             class="w-5 h-5 hidden">
          <rect x="6" y="6" width="12" height="12" rx="2" ry="2"></rect>
        </svg>
      </button>

      <!-- Download button -->
      <button id="download-btn"
              class="p-2 rounded-full bg-white hover:bg-gray-100 text-black focus:outline-none transition-colors border border-gray-200"
              aria-label="Download results">
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 24 24"
             fill="none"
             stroke="black"
             stroke-width="2"
             stroke-linecap="round"
             stroke-linejoin="round"
             class="w-5 h-5 pointer-events-none">
          <path d="M4 16v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"/>
          <g id="download-arrow">
          <path d="M7 10l5 5 5-5"/>
          <path d="M12 15V4"/>
          </g>
        </svg>
      </button>

      <button id="toggle-json"
              class="p-2 rounded-full bg-yellow-200 text-yellow-800 hover:bg-yellow-300 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
             stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <path d="M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1"></path>
          <path d="M16 12a1 1 0 0 1 1 1v1a1 1 0 0 0 1 1"></path>
          <line x1="12" y1="18" x2="12" y2="18.01"></line>
        </svg>
      </button>
      <button id="toggle-queries"
              class="p-2 rounded-full bg-blue-200 text-blue-800 hover:bg-blue-300 transition-colors"
              aria-label="Queries">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none">
          <rect x="3" y="5" width="18" height="14" rx="2"/>
          <line x1="8" y1="9" x2="16" y2="9"/>
          <line x1="8" y1="13" x2="14" y2="13"/>
        </svg>
      </button>
      <button id="toggle-help"
              class="p-2 rounded-full bg-purple-200 text-purple-800 hover:bg-purple-300 transition-colors"
              aria-label="Help">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 pointer-events-none">
          <circle cx="12" cy="12" r="10"></circle>
          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
      </button>
    </div>
  </div>
  
  <div id="condition-panel" class="gap-4"></div>
  <div id="condition-input-wrapper">
    <div id="bubble-cond-list"></div>
    <input id="condition-input" class="condition-field" type="text" placeholder="Enter value…" />
    <span id="between-label" class="mx-2 font-semibold" style="display:none;">‑</span>
    <input id="condition-input-2" class="condition-field" type="text" placeholder="Enter value…" style="display:none;" />
    <button id="confirm-btn" class="confirm-btn" title="Confirm">&#10003;</button>
    <span id="filter-error"
          class="ml-3 text-red-600 text-sm font-semibold"></span>
  </div>
  <div class="max-w-5xl mx-auto">
    <div class="overflow-x-auto shadow rounded-lg mb-6 relative max-w-[50vw] mx-auto" style="background: #fff;">
      <table id="example-table" class="min-w-full divide-y divide-gray-200 bg-white">
        <thead></thead>
        <tbody></tbody>
      </table>
      <div id="placeholder-message"
           class="py-8 absolute inset-0 flex items-center justify-center text-center text-gray-500 italic pointer-events-none">
        Drag a bubble here to add your first column
      </div>
    </div>
    <div class="mb-6 text-center">
      <div class="relative w-full max-w-3xl mx-auto">
        <input
          type="text"
          placeholder="Type to find a specific field bubble…"
          class="w-full pr-14 px-6 py-3 rounded-full shadow bg-white bg-opacity-70 backdrop-blur-md placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-yellow-300 text-center transition-all duration-300"
          id="query-input"
        />
        <!-- clear‑search "×" button -->
        <button id="clear-search-btn"
                class="hidden absolute right-4 top-1/2 transform -translate-y-1/2 p-1 rounded-full bg-gray-200 bg-opacity-80 hover:bg-gray-300 focus:outline-none"
                aria-label="Clear search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="#374151" stroke-width="2"
               stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
            <line x1="4" y1="4" x2="16" y2="16" />
            <line x1="16" y1="4" x2="4" y2="16" />
          </svg>
        </button>
      </div>
    </div>
    <div id="category-bar"
         class="mb-4 flex w-max gap-0 mx-auto"></div>
    <!-- bubble grid + scrollbar -->
    <div class="flex items-start justify-center">
      <div id="bubble-container" class="overflow-hidden" style="max-width:720px;">
        <div id="bubble-list" class="flex flex-wrap gap-4 justify-center"></div>
      </div>
      <!-- Bubble pagination -->
      <div id="bubble-nav" class="ml-4 flex flex-col items-center">
        <div id="bubble-scrollbar" class="bubble-scrollbar-container">
          <div id="bubble-scrollbar-track" class="bubble-scrollbar-track"></div>
          <div id="bubble-scrollbar-thumb" class="bubble-scrollbar-thumb"></div>
        </div>
      </div>
    </div> <!-- end wrapper -->

    <!-- JSON PANEL -->
    <div id="json-panel" class="w-full modal-panel hidden">
      <h2 class="mt-8 mb-0 px-3 py-2 rounded-t bg-yellow-100 text-yellow-800 font-semibold text-sm uppercase tracking-wider border border-yellow-200 flex items-center justify-between">
        <span>JSON</span>
        <div class="flex gap-2 ml-auto items-center">
          <button id="copy-json-btn"
                  class="p-1.5 rounded hover:bg-yellow-200 focus:outline-none transition-colors"
                  aria-label="Copy JSON to clipboard">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="#ca8a04" stroke-width="2"
                 stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
            </svg>
          </button>
          <button class="collapse-btn p-1.5 rounded hover:bg-yellow-200 focus:outline-none transition-colors ml-2" data-target="json-panel" aria-label="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="#ca8a04" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
              <line x1="4" y1="4" x2="16" y2="16" />
              <line x1="16" y1="4" x2="4" y2="16" />
            </svg>
          </button>
        </div>
      </h2>
      <textarea id="query-json"
                class="w-full -mt-px p-4 border border-yellow-200 border-t-0 rounded-b bg-gray-50 font-mono text-sm resize-none"
                rows="10"
                readonly
      ></textarea>
    </div><!-- end json-panel -->

    <!-- QUERIES PANEL -->
    <div id="queries-panel" class="w-full modal-panel hidden">
      <h2 class="mt-8 mb-0 px-3 py-2 rounded-t bg-blue-100 text-blue-800 font-semibold text-sm uppercase tracking-wider border border-blue-200 flex items-center justify-between">
        <span>Queries</span>
        <button class="collapse-btn p-1.5 rounded hover:bg-blue-200 focus:outline-none transition-colors ml-2" data-target="queries-panel" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="#2563eb" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
            <line x1="4" y1="4" x2="16" y2="16" />
            <line x1="16" y1="4" x2="4" y2="16" />
          </svg>
        </button>
      </h2>
      <div id="queries-container"
           class="w-full -mt-px border border-blue-200 border-t-0 rounded-b overflow-x-auto bg-white">
        <!-- list will be injected here -->
      </div>
    </div><!-- end queries-panel -->

    <!-- HELP PANEL -->
    <div id="help-panel" class="w-full modal-panel hidden">
      <h2 class="mt-8 mb-0 px-3 py-2 rounded-t bg-purple-100 text-purple-800 font-semibold text-sm uppercase tracking-wider border border-purple-200 flex items-center justify-between">
        <span>Help</span>
        <button class="collapse-btn p-1.5 rounded hover:bg-purple-200 focus:outline-none transition-colors ml-2" data-target="help-panel" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="none" stroke="#7e22ce" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
            <line x1="4" y1="4" x2="16" y2="16" />
            <line x1="16" y1="4" x2="4" y2="16" />
          </svg>
        </button>
      </h2>
      <div id="help-container" class="w-full -mt-px border border-purple-200 border-t-0 rounded-b overflow-y-auto bg-white p-4">
        <h3 class="text-lg font-semibold mb-3">Getting Started</h3>
        <p class="mb-3">Use this tool to build library item queries and reports.</p>
        
        <h4 class="text-md font-semibold mt-4 mb-2">Working with Bubbles</h4>
        <ul class="list-disc pl-5 mb-3">
          <li>Click a bubble to view filter options</li>
          <li>Drag bubbles to the table area to add columns</li>
          <li>White bubbles indicate fields that are already filtered or displayed</li>
        </ul>
        
        <h4 class="text-md font-semibold mt-4 mb-2">Building Queries</h4>
        <ul class="list-disc pl-5 mb-3">
          <li>Apply filters by clicking bubbles and selecting conditions</li>
          <li>Rearrange columns by dragging table headers</li>
          <li>Remove columns by hovering over a header and clicking the trash icon</li>
          <li>View and edit your query JSON by clicking the JSON button</li>
        </ul>
        
        <h4 class="text-md font-semibold mt-4 mb-2">Running Queries</h4>
        <ul class="list-disc pl-5 mb-3">
          <li>Click the green play button to run your query</li>
          <li>Click it again (stop icon) to cancel a running query</li>
          <li>Download results using the download button</li>
          <li>View your query history in the Queries panel</li>
        </ul>
      </div>
    </div><!-- end help-panel -->
  </div>
<script src="query.js"></script>
</body>
